<!DOCTYPE html>
<html lang="{{ i18n.get_language() if i18n else 'en' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIGiDIG Login</title>

    <!-- DIGiDIG shared styles -->
    <link rel="stylesheet" href="/digidig/assets/style.css">
    <link rel="stylesheet" href="/lib/common/components/auth-button/auth-button.css">
    <link rel="stylesheet" href="/lib/common/components/dark-mode-switch/dark-mode-switch.css">
    <link rel="stylesheet" href="/lib/common/components/language-selector/language-selector.css">

    <!-- Login page specific styles -->
    <style>

        body {
            font-family: Arial, sans-serif;
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            background: var(--bg-color, #f5f5f5);
            color: var(--text-color, #333);
            transition: background-color 0.3s, color 0.3s;
        }

        .dark-mode {
            --bg-color: #15171c;
            --text-color: #e2e2e2;
        }

        .dark-mode body, body.dark-mode {
            background: #15171c !important;
            color: #e2e2e2 !important;
        }

        .dark-mode .login-form {
            background: #23242a !important;
            color: #fff !important;
            box-shadow: 0 4px 32px rgba(0,0,0,0.7) !important;
        }

        .dark-mode input,
        .dark-mode input[type="email"],
        .dark-mode input[type="password"] {
            background: #181a20 !important;
            color: #fff !important;
            border: 1px solid #444 !important;
        }

        .dark-mode input:focus {
            border-color: #4fa3ff !important;
            outline: none !important;
        }

        .dark-mode input::placeholder {
            color: #aaa !important;
        }

        .dark-mode button {
            background: #2563eb !important;
            color: #fff !important;
            border: none !important;
        }

        .dark-mode button:hover {
            background: #1746a2 !important;
        }

        .dark-mode .error {
            background: #3a2323 !important;
            border-color: #a33 !important;
            color: #ffbdbd !important;
        }

        .dark-mode h2 {
            color: #fff !important;
        }

        .dark-mode .app-info {
            color: #aaa !important;
        }

        .login-form {
            background: var(--panel-bg, white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: background-color 0.3s, color 0.3s;
        }

        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid var(--border-color, #ddd);
            border-radius: 4px;
            box-sizing: border-box;
            background: var(--input-bg, white);
            color: var(--text-color, #333);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: var(--accent-color, #007bff);
        }

        button {
            width: 100%;
            padding: 10px;
            background: var(--button-bg, #007bff);
            color: var(--button-text, white);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        button:hover {
            background: var(--button-hover, #0056b3);
        }

        .error {
            color: var(--error-text, #dc3545);
            background: var(--error-bg, #f8d7da);
            border: 1px solid var(--error-border, #f5c6cb);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .app-info {
            text-align: center;
            color: var(--text-muted, #666);
            margin-bottom: 20px;
            font-size: 14px;
        }

        .login-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }
    </style>
</head>
<body{% if dark_mode %} class="dark-mode"{% endif %}>
    <!-- Page Controls in top-right corner -->
    <div class="page-controls">
        <div data-component="dark-mode-switch"></div>
        <div data-component="language-selector"></div>
    </div>

    <div class="login-container">
        <div class="login-form">
            <h2>{{ i18n.get('auth.login', 'Login') if i18n else 'Login' }}</h2>
            
            {% if app_name %}
            <div class="app-info">
                {{ i18n.get('auth.signing_in_to', 'Signing in to') if i18n else 'Signing in to' }}: <strong>{{ app_name }}</strong>
            </div>
            {% endif %}

            {% if error %}
            <div class="error">{{ error }}</div>
            {% endif %}

            <form method="post" action="/login?app={{ app_name }}">
                <input type="email" name="email" placeholder="{{ i18n.get('auth.email', 'Email') if i18n else 'Email' }}" required autofocus>
                <input type="password" name="password" placeholder="{{ i18n.get('auth.password', 'Password') if i18n else 'Password' }}" required>
                <button type="submit">{{ i18n.get('auth.login', 'Login') if i18n else 'Login' }}</button>
            </form>
        </div>
    </div>

    <!-- Shared JavaScript utilities -->
    <script src="/lib/common/components/shared/utils.js"></script>
    <script src="/lib/common/components/shared/preferences-manager.js"></script>

    <!-- Main DigiDig namespace -->
    <script src="/lib/common/components/digidig.js"></script>

    <!-- Component scripts -->
    <script src="/lib/common/components/auth-button/auth-button.js"></script>
    <script src="/lib/common/components/dark-mode-switch/dark-mode-switch.js"></script>
    <script src="/lib/common/components/language-selector/language-selector.js"></script>

    <!-- Initialize components -->
    <script>
        // Global service URLs for JavaScript
        window.DIGIDIG_SERVICE_URLS = {
            identity: '{{ identity_url }}'
        };

        // Global i18n for JavaScript components
        window.DIGIDIG_I18N = {
            logout: "{{ i18n.get('auth.logout', 'Logout') if i18n else 'Logout' }}",
            login: "{{ i18n.get('auth.login', 'Login') if i18n else 'Login' }}"
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize preferences
            window.DigiDigPreferences.getPreferences().then(function(prefs) {
                // Apply language
                if (prefs.language) {
                    document.documentElement.lang = prefs.language;
                }

                // Apply dark mode only if not already applied server-side
                if (prefs.darkMode && !document.body.classList.contains('dark-mode')) {
                    document.body.classList.add('dark-mode');
                } else if (!prefs.darkMode && document.body.classList.contains('dark-mode')) {
                    document.body.classList.remove('dark-mode');
                }
            });

            // Components auto-initialize themselves
        });
    </script>
</body>
</html>