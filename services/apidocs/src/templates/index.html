<!DOCTYPE html>
<html lang="{{ current_language }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ translations.title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
</head>
<body>
    <!-- Language Selector -->
    <div class="language-selector">
        <select id="languageSelect" onchange="changeLanguage()">
            <option value="en" {% if current_language == 'en' %}selected{% endif %}>English</option>
            <option value="cs" {% if current_language == 'cs' %}selected{% endif %}>Čeština</option>
        </select>
    </div>

    <div class="container">
        <div class="header">
            <h1>{{ translations.title }}</h1>
            <p>{{ translations.subtitle }}</p>
        </div>

        <div class="combined-docs">
            <h2>{{ translations.combined_docs_title }}</h2>
            <p>{{ translations.combined_docs_description }}</p>
            <a href="/api/openapi/combined" class="btn btn-primary" style="display: inline-block; max-width: 200px;">
                {{ translations.view_combined_api }}
            </a>
        </div>

        <div class="services-grid">
            {% for service_id, service in services.items() %}
            <div class="service-card" data-service="{{ service_id }}">
                <div class="health-status" id="health-{{ service_id }}"></div>
                
                <div class="service-icon">{{ service.icon }}</div>
                <div class="service-name">{{ service.name }}</div>
                <div class="service-description">{{ service.description }}</div>
                
                <div class="service-tags">
                    {% for tag in service.tags %}
                    <span class="tag">{{ tag }}</span>
                    {% endfor %}
                </div>
                
                <div class="service-actions">
                    <a href="/docs/{{ service_id }}" class="btn btn-primary">
                        {{ translations.swagger_ui }}
                    </a>
                    <a href="/redoc/{{ service_id }}" class="btn btn-secondary">
                        {{ translations.redoc }}
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="footer">
            <p>{{ translations.footer }}</p>
        </div>
    </div>

    <script>
        // Language selector functionality
        async function changeLanguage() {
            const select = document.getElementById('languageSelect');
            const language = select.value;
            
            try {
                const response = await fetch('/api/language', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ language: language })
                });
                
                if (response.ok) {
                    window.location.reload();
                }
            } catch (error) {
                console.error('Failed to change language:', error);
            }
        }

        // Dark mode support
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.body.classList.add('dark-mode');
            }
        }

        // Check health status for all services
        async function checkHealth() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                for (const [serviceId, health] of Object.entries(data.services)) {
                    const statusEl = document.getElementById(`health-${serviceId}`);
                    if (statusEl) {
                        statusEl.className = `health-status ${health.status}`;
                        statusEl.title = health.message;
                    }
                }
            } catch (error) {
                console.error('Failed to check health:', error);
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            checkHealth();
            setInterval(checkHealth, 30000); // Every 30 seconds
        });
    </script>
</body>
</html>
