<!DOCTYPE html>
<html lang="{{ i18n.get_language() }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - DIGiDIG Admin</title>
    <meta name="digidig-authenticated" content="{{% if user %}}true{{% else %}}false{{% endif %}}">

    <!-- DIGiDIG shared styles -->
    <link rel="stylesheet" href="/lib/common/components/top-pane/top-pane.css">
    <link rel="stylesheet" href="/lib/common/components/auth-button/auth-button.css">

    <!-- App-specific styles -->
    <link rel="stylesheet" href="{{ url_for('static', path='css/layout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='css/{{ current_page }}.css') }}">
</head>
<body>
    <!-- Server-side include of shared top-pane component -->
    {% include 'top-pane/top-pane.html' %}

    <div class="main-layout">
        <!-- Left pane: menu -->
        <aside class="left-pane">
            <nav class="menu">
                <ul>
                    <li><a href="/domains" class="menu-item {% if current_page == 'domains' %}active{% endif %}">{{ i18n.get('admin.menu.domains', 'Domains') }}</a></li>
                    <li><a href="/services" class="menu-item {% if current_page == 'services' %}active{% endif %}">{{ i18n.get('admin.menu.services', 'Services') }}</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Right pane: content -->
        <main class="right-pane">
            {% if current_page == 'domains' %}
                {% include 'pages/domains.html' %}
            {% elif current_page == 'services' %}
                {% include 'pages/services.html' %}
            {% endif %}
        </main>
    </div>

    <!-- Shared JavaScript utilities -->
    <script src="/lib/common/components/shared/utils.js"></script>
    <script src="/lib/common/components/shared/preferences-manager.js"></script>

    <!-- Component scripts -->
    <script src="/lib/common/components/top-pane/top-pane.js"></script>
    <script src="/lib/common/components/auth-button/auth-button.js"></script>

    <!-- App-specific scripts -->
    <script src="{{ url_for('static', path='js/app.js') }}"></script>
    <script src="{{ url_for('static', path='js/{{ current_page }}.js') }}"></script>

    <!-- Main DigiDig namespace -->
    <script src="/lib/common/components/digidig.js"></script>

    <!-- Initialize components -->
    <script>
        // Global service URLs for JavaScript
        window.DIGIDIG_SERVICE_URLS = {{ service_urls|tojson }};

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize preferences
            window.DigiDigPreferences.getPreferences().then(function(prefs) {
                // Apply language
                if (prefs.language) {
                    document.documentElement.lang = prefs.language;
                }

                // Apply dark mode
                if (prefs.darkMode) {
                    document.body.classList.add('dark-mode');
                }
            });

            // Initialize components using DigiDig.init()
            DigiDig.init();
        });
    </script>
</body>
</html>